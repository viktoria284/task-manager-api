# Лабораторная работа №3: «Разработка клиента к внешнему REST API»

## 1. Ссылка на API
- Репозиторий: ` `
- Swagger UI: `http://host:3000/api-docs`

## 2. Краткое описание клиента
**Язык:** Python 3  
**Библиотеки:** `requests`, `python-dotenv`  
**Структура:**
- `courseuni_client/client.py` — класс `CourseUniClient` (все запросы + обработка ошибок/лимитов)
- `courseuni_client/exceptions.py` — исключение `ApiError`
- `cli.py` — демонстрационный сценарий вызовов (health → create user → create course → idempotent enroll → pagination)

## 3. Примеры запросов и ответов

### 3.1 Health check
`GET /api/v1/health`  
Пример ответа:
```json
{ "status": "ok" }
```

### 3.2 Создание пользователя
`POST /api/v2/users`  
Заголовок:
```http
X-API-Key: <API_KEY>
```
Тело:
```json
{
  "firstName": "Vika",
  "lastName": "Student",
  "email": "student_xxxxxxxx@example.com",
  "birthday": "2004-05-20",
  "bio": "client demo",
  "role": "student"
}
```

### 3.3 Идемпотентная операция
`POST /api/v2/enrollments` с заголовком:
```http
Idempotency-Key: <uuid>
```
Повтор того же запроса с тем же ключом возвращает уже созданную запись и не создаёт дубль.

### 3.4 Пагинация + include
`GET /api/v2/courses?page=1&limit=5&include=title,level,rating`

## 4. Ошибки и нештатные ситуации

### 4.1 Неверный API key
Если `X-API-Key` отсутствует или неправильный — сервер возвращает `401`.

### 4.2 Rate limit
При превышении лимита сервер возвращает `429 Too Many Requests` и заголовок `Retry-After`.
Клиент читает `Retry-After`, ждёт и повторяет запрос (ограниченное число попыток).

### 4.3 404 Not found
При запросе несуществующего ресурса (например, курс по несуществующему id) сервер возвращает `404`.

## 5. Оценка удобства API (мнение)
**Плюсы:**
- понятная структура ресурсов (users/courses/enrollments);
- есть Swagger (`/api-docs`);
- есть версия v2 с пагинацией и выбором полей (`include`);
- есть идемпотентность через `Idempotency-Key`.

**Минусы/особенности:**
- аутентификация через API-key простая, но не даёт “пользовательских” ролей/прав (это ок для лабораторной);
- у разных ошибок формат может отличаться (поэтому в клиенте сделана универсальная обработка ошибок).

## 6. Предложения по улучшению API
- добавить единый формат ошибок (например `{ "error": { "code": "...", "message": "...", "details": ... } }`);
- добавить примеры запросов/ответов прямо в Swagger для всех методов;
- добавить описание rate limit в Swagger (заголовки и поведение при 429).
